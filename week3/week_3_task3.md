# Week 3 任务指南：Lazy Intruder 与 身份提供商 (IdP)

本周的任务核心是增强协议的现实性，引入身份提供商（Identity Provider, IdP），并运用 Lazy Intruder 技术手动验证协议角色的可执行性。

---

## 1. 协议开发任务：引入身份提供商 (IdP)
在第二周的简化版本中，我们假设所有人都拥有公钥。本周需要让协议更加“全面”，重点调整 **Agent A** 的身份验证逻辑。

### 核心变更：
*   **取消 A 的初始密钥**：A 在初始状态下不再拥有安全的公私钥对（`inv(pk(A))`）。
*   **引入密码 (Password)**：A 与 **身份提供商 (IdP)** 之间拥有一个共享秘密——密码（Password）。
    *   **限制**：密码不能作为加密密钥使用（因为它不是一个强随机的加密密钥），通常仅用于生成签名或在 IdP 处证明身份。
*   **IdP 授权流程**：A 必须依靠 IdP 来验证自己或自己的请求。当 A 需要访问资源或授权 P 时，需要先通过 IdP 的认证。
*   **初始知识简化**：为了降低难度，本周仍允许假设 A 初始知道所有人的公钥。

### 建模目标：
*   更新 `.AnB` 文件。
*   将 A 认证 P 的逻辑改为：A -> IdP (使用密码认证) -> IdP 签发声明 -> A 将声明转发给 P/B。

---

## 2. 本周特殊任务 (Special Task)：Lazy Intruder 静态分析
你需要证明协议中 **照片打印服务 P** 的角色是**可执行的 (Executable)**。即：如果入侵者 $i$ 扮演 $P$，他是否能够根据已收到的消息构造出所有需要发出的消息？

### 任务要求：
*   **角色配置**：将角色 $P$ 实例化为入侵者 $i$，其余角色（A, B, IdP）保持为诚实代理。
*   **分析方法**：必须严格遵循课件中定义的 **Lazy Intruder (懒惰入侵者)** 方法。
*   **展示步骤**：
    1.  列出 $P$ 在协议中预期的所有 **接收 (Receive)** 和 **发送 (Send)** 动作序列。
    2.  对于每一个发送动作，展示入侵者如何利用其**当前知识库**（包含初始知识和之前收到的所有消息内容）通过 Dolev-Yao 规则推导出发送所需的消息。
    3.  标注推导的步骤（如：Analysis, Composition）。

---

## 3. 实验日志更新 (Lab Logbook)
在 `lab_logbook.md` 中记录本周的进展快照，必须包含：
*   **版本说明**：本版本与 Week 2 相比有哪些改变（重点描述 IdP 和 Password 的引入）。
*   **建模考量**：
    *   如何处理 A 与 IdP 之间的 Password。
    *   IdP 如何对 A 的请求进行“背书”（例如签发证书或令牌）。
*   **问题记录**：
    *   使用 OFMC 运行新版协议后，是否发现了新的攻击？
    *   Lazy Intruder 手动推导过程中是否发现某些步骤无法执行？
*   **讨论总结**：记录小组成员对 IdP 交互流程设计的想法。

---

## 4. 关键技术点提示 (来自课件)
*   **Lazy Intruder 核心逻辑**：入侵者并不盲目搜索所有可能的消息，而是“懒惰”地仅在需要匹配诚实代理的接收要求时，才去验证其知识库是否能构造出该消息。
*   **Symbolic Filtering**：在分析时，注意变量的实例化过程，确保推导逻辑严密。
